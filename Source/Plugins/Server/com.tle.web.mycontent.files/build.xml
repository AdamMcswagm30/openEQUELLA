<?xml version="1.0" encoding="UTF-8"?>
<project name="com.tle.web.mycontent.files" basedir="." default="compile">
	<property name="compile.for.server" value="true" />
	<import file="../../build/plugins-common-build.xml" />
	
	<property name="downloads.dir" location="resources/web/downloads" />
	<property name="installer.name.final" value="EquellaOfficeIntegrationInstaller.msi" />
	<property name="installer.name.artifactory" value="OfficeIntegrationInstaller-6.2.msi" />
	
	<target name="clean" depends="common.clean">
		<delete dir="${downloads.dir}" />
	</target>
	
	<target name="init" depends="common.init">
		<mkdir dir="${downloads.dir}" />
	</target>
	
	<target name="-init-nexus-credentials">
		<property file="${user.home}/.pearsonNexusCredentials" />
		<fail unless="nexus.username" message="You must declare nexus.username via -D or in ${user.home}/.pearsonNexusCredentials" />
		<fail unless="nexus.password" message="You must declare nexus.password via -D or in ${user.home}/.pearsonNexusCredentials" />
		<echo>Using Nexus credentials with username ${nexus.username}</echo>
	</target>
	
	<target name="make" depends="common.make, -init-nexus-credentials">
		<taskdef classname="com.tle.ant.dependencies.DownloadJars" name="downloadJars" classpathref="customtasks.classpath" />
		<downloadJars destDir="${staging}" dependencies="deps-mycontentfiles.txt">
			<!-- FIXME need repos -->
		</downloadJars>

		<copy file="${staging}/${installer.name.artifactory}" tofile="${downloads.dir}/${installer.name.final}" />
	</target>
</project>
